<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruleta_JAIDER</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .upload-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px dashed #667eea;
            border-radius: 10px;
            text-align: center;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            display: inline-block;
        }

        .file-input-label:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .file-name {
            margin-top: 10px;
            color: #666;
            font-size: 14px;
        }

        .ruleta-container {
            position: relative;
            width: 500px;
            height: 500px;
            margin: 40px auto;
            perspective: 1000px;
        }

        .ruleta {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transition: transform 8s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            position: relative;
        }

        .ruleta.spinning {
            animation: spin 8s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(1800deg);
            }
        }

        .nombre-display {
            font-size: 2.2em;
            font-weight: bold;
            color: white;
            text-align: center;
            padding: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            word-break: break-word;
        }

        .pointer {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            z-index: 10;
        }

        .pointer-triangle {
            width: 0;
            height: 0;
            border-top: 30px solid transparent;
            border-bottom: 30px solid transparent;
            border-right: 45px solid #ff3838;
            filter: drop-shadow(-4px 0 8px rgba(255, 56, 56, 0.5));
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .button-container {
            text-align: center;
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }

        .spin-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 18px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .spin-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        .spin-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .sound-toggle {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 18px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .sound-toggle:hover {
            background: #218838;
            transform: translateY(-3px);
        }

        .sound-toggle.muted {
            background: #dc3545;
        }

        .sound-toggle.muted:hover {
            background: #c82333;
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
        }

        .result h2 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .result p {
            font-size: 1.5em;
            color: #333;
            font-weight: bold;
        }

        .info {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4f8;
            border-radius: 10px;
            font-size: 14px;
            color: #555;
        }

        .historial {
            margin-top: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
        }

        .historial h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .historial-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .historial-item {
            background: #ffc107;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 13px;
            color: #333;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üéØ Ruleta_JAIDER</h1>

        <div class="upload-section">
            <div class="file-input-wrapper">
                <label for="fileInput" class="file-input-label">
                    üìÅ Cargar Hoja de C√°lculo
                </label>
                <input type="file" id="fileInput" accept=".xlsx,.xls,.csv">
            </div>
            <div class="file-name" id="fileName">No se ha seleccionado ning√∫n archivo</div>
        </div>

        <div class="info">
            <strong>üìã</strong> Sube un archivo Excel o CSV con una columna de nombres.
        </div>

        <div class="ruleta-container">
            <div class="pointer">
                <div class="pointer-triangle"></div>
            </div>
            <div class="ruleta" id="ruleta">
                <div class="nombre-display" id="nombreDisplay">Cargue nombres</div>
            </div>
        </div>

        <div class="button-container">
            <button class="spin-button" id="spinButton" disabled>üé≤ Girar Ruleta</button>
            <button class="sound-toggle" id="soundToggle">üîä Sonido</button>
        </div>

        <div class="result" id="result" style="display: none;">
            <h2>¬°Seleccionado!</h2>
            <p id="selectedName"></p>
        </div>

        <div class="historial" id="historial" style="display: none;">
            <div class="historial-list" id="historialList"></div>
        </div>
    </div>

    <script>
        let nombres = [];
        let historialRecientes = [];
        let isSpinning = false;
        let soundEnabled = true;
        let audioContext;
        let clickSound;
        let winSound;

        const fileInput = document.getElementById('fileInput');
        const fileName = document.getElementById('fileName');
        const spinButton = document.getElementById('spinButton');
        const soundToggle = document.getElementById('soundToggle');
        const ruleta = document.getElementById('ruleta');
        const nombreDisplay = document.getElementById('nombreDisplay');
        const result = document.getElementById('result');
        const selectedName = document.getElementById('selectedName');
        const historial = document.getElementById('historial');
        const historialList = document.getElementById('historialList');

        // Inicializar contexto de audio
        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }

        // Crear sonido de click (tic-tac de ruleta)
        function playClickSound() {
            if (!soundEnabled || !audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.05);
        }

        // Crear sonido de victoria
        function playWinSound() {
            if (!soundEnabled || !audioContext) return;

            const notes = [523.25, 659.25, 783.99]; // Do, Mi, Sol
            notes.forEach((freq, index) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = freq;
                oscillator.type = 'sine';

                const startTime = audioContext.currentTime + (index * 0.1);
                gainNode.gain.setValueAtTime(0.2, startTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);

                oscillator.start(startTime);
                oscillator.stop(startTime + 0.3);
            });
        }

        // Toggle sonido
        soundToggle.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            soundToggle.classList.toggle('muted');
            soundToggle.textContent = soundEnabled ? 'üîä Sonido' : 'üîá Mudo';

            if (soundEnabled && !audioContext) {
                initAudio();
            }
        });

        fileInput.addEventListener('change', handleFileUpload);
        spinButton.addEventListener('click', girarRuleta);

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            fileName.textContent = file.name;
            const reader = new FileReader();

            reader.onload = function (e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                nombres = jsonData
                    .flat()
                    .filter(nombre => nombre && nombre.toString().trim() !== '')
                    .map(nombre => nombre.toString().trim());

                if (nombres.length > 0) {
                    spinButton.disabled = false;
                    nombreDisplay.textContent = `${nombres.length} nombres cargados`;
                    historialRecientes = [];
                    actualizarHistorial();
                } else {
                    alert('No se encontraron nombres en el archivo');
                }
            };

            reader.readAsArrayBuffer(file);
        }

        function girarRuleta() {
            if (isSpinning || nombres.length === 0) return;

            // Inicializar audio en el primer click si es necesario
            if (!audioContext && soundEnabled) {
                initAudio();
            }

            isSpinning = true;
            spinButton.disabled = true;
            result.style.display = 'none';

            // Obtener nombres disponibles (excluyendo los √∫ltimos 14)
            let nombresDisponibles = nombres.filter(n => !historialRecientes.includes(n));

            // Si no hay nombres disponibles (todos est√°n en el historial), usar todos
            if (nombresDisponibles.length === 0) {
                nombresDisponibles = [...nombres];
            }

            // Seleccionar nombre aleatorio
            const nombreSeleccionado = nombresDisponibles[Math.floor(Math.random() * nombresDisponibles.length)];

            // Animaci√≥n de ruleta
            ruleta.classList.add('spinning');

            // Mostrar nombres aleatorios durante el giro con sonidos
            let counter = 0;
            let clickInterval = 100; // Empieza r√°pido
            let animationInterval;

            function animateWithSound() {
                if (counter < 60) {
                    const randomName = nombres[Math.floor(Math.random() * nombres.length)];
                    nombreDisplay.textContent = randomName;
                    playClickSound();

                    counter++;
                    // Ralentizar gradualmente
                    clickInterval += 10;
                    animationInterval = setTimeout(animateWithSound, clickInterval);
                }
            }

            animateWithSound();

            // Despu√©s de 6 segundos, mostrar resultado
            setTimeout(() => {
                // Detener animaci√≥n
                clearTimeout(animationInterval);

                ruleta.classList.remove('spinning');
                // IMPORTANTE: Establecer el mismo nombre en ambos lugares
                nombreDisplay.textContent = nombreSeleccionado;
                selectedName.textContent = nombreSeleccionado;
                result.style.display = 'block';

                // Sonido de victoria
                playWinSound();

                // Actualizar historial
                historialRecientes.push(nombreSeleccionado);
                if (historialRecientes.length > 5) {
                    historialRecientes.shift();
                }
                actualizarHistorial();

                isSpinning = false;
                spinButton.disabled = false;
            }, 6000);
        }

        function actualizarHistorial() {
            if (historialRecientes.length > 0) {
                historial.style.display = 'block';
                historialList.innerHTML = historialRecientes
                    .map(nombre => `<div class="historial-item">${nombre}</div>`)
                    .join('');
            } else {
                historial.style.display = 'none';
            }
        }
    </script>
</body>

</html>
